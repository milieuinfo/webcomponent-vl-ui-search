<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <script src="../../../@webcomponents/webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../../../web-component-tester/browser.js"></script>
  <script src="../../../chai/chai.js"></script>

  <script type="module" src="../../src/vl-search.src.js"></script>
</head>

<body>

  <test-fixture id="vl-search-fixture">
    <template>
      <vl-search></vl-search>
    </template>
  </test-fixture>

  <test-fixture id="vl-search-inline-fixture">
    <template>
      <vl-search inline></vl-search>
    </template>
  </test-fixture>

  <test-fixture id="vl-search-block-fixture">
    <template>
      <vl-search block></vl-search>
    </template>
  </test-fixture>

  <script>
    suite('<vl-search>', () => {

      test('standaard wordt block gebruikt indien inline of block niet expliciet gezet', () => {
        const search = fixture('vl-search-fixture');
        assert.isTrue(search.hasAttribute('block'));
        assert.isTrue(search._element.classList.contains('vl-search--block'));
      });

      test('wanneer het block attribuut wordt gebruikt, is de block class aanwezig', () => {
        const search = fixture('vl-search-block-fixture');
        assert.isTrue(search.hasAttribute('block'));
        assert.isTrue(search._element.classList.contains('vl-search--block'));
      });

      test('wanneer het inline attribuut wordt gebruikt, is de inline class aanwezig', () => {
        const search = fixture('vl-search-inline-fixture');
        assert.isTrue(search.hasAttribute('inline'));
        assert.isTrue(search._element.classList.contains('vl-search--inline'));
      });

      test('wanneer het inline attribuut wordt verwijderd, wordt block attribuut gezet', () => {
        const search = fixture('vl-search-inline-fixture');
        search.removeAttribute('inline');
        assert.isTrue(search.hasAttribute('block'));
        assert.isTrue(search._element.classList.contains('vl-search--block'));
      });

      test('wanneer het block attribuut wordt verwijderd, wordt het inline attribuut gezet', () => {
        const search = fixture('vl-search-block-fixture');
        search.removeAttribute('block');
        assert.isTrue(search.hasAttribute('inline'));
        assert.isTrue(search._element.classList.contains('vl-search--inline'));
      });

      test('wanneer het alt attribuut wordt gezet, is de alt class aanwezig', () => {
        const search = fixture('vl-search-block-fixture');
        assert.isFalse(search._element.classList.contains('vl-search--alt'));
        search.setAttribute('alt', '');
        assert.isTrue(search._element.classList.contains('vl-search--alt'));
        search.removeAttribute('alt');
        assert.isFalse(search._element.classList.contains('vl-search--alt'));
      });

      test('wanneer het label attribuut wordt gezet bij block display, verschijnt dit', () => {
        const search = fixture('vl-search-block-fixture');

        assert.isFalse(search.hasAttribute('data-vl-label'));
        assert.equal(search.__labelTekst(), 'Zoekterm');
        assert.equal(search.__labelElement.innerText, 'Zoekterm');
        assert.isNull(search.__labelElement.querySelector('span'));

        search.setAttribute('data-vl-label', 'foo');
        assert.equal(search.__labelTekst(), 'foo');
        assert.equal(search.__labelElement.innerText, 'foo');
        assert.isNull(search.__labelElement.querySelector('span'));
      });

      test('wanneer het label attribuut wordt gezet bij inline display, wordt dit gezet', () => {
        const search = fixture('vl-search-inline-fixture');

        assert.isFalse(search.hasAttribute('data-vl-label'));
        assert.equal(search.__labelTekst(), 'Zoekterm');
        assert.isEmpty(search.__labelElement.firstChild.textContent.trim());
        assert.equal(search.__labelElement.querySelector('span').innerText, 'Zoekterm');

        search.setAttribute('data-vl-label', 'bar');
        assert.equal(search.__labelTekst(), 'bar');
        assert.isEmpty(search.__labelElement.firstChild.textContent.trim());
        assert.equal(search.__labelElement.querySelector('span').innerText, 'bar');
      });

      test('wanneer op de zoekknop wordt geklikt wordt een submit event met zoekterm verstuurd',
          (done) => {
            const search = fixture('vl-search-block-fixture');
            search.addEventListener('submit',
                (event) => {
                  assert.equal(event.detail.zoekterm, 'foo');
                  done();
                });
            search.__zoekveldElement.value = 'foo';
            search.__zoekknopElement.click();
          }
      );

      test('wanneer op enter wordt gedrukt in de input wordt een submit event met zoekterm verstuurd',
          (done) => {
              const search = fixture('vl-search-block-fixture');
              search.addEventListener('submit',
                  (event) => {
                    assert.equal(event.detail.zoekterm, 'bar');
                    done();
                  });
              search.__zoekveldElement.value = 'bar';
              search.__zoekveldElement.dispatchEvent(new KeyboardEvent('keydown', {key: 'Enter'}))
          }
      );


    });

  </script>
</body>

</html>
